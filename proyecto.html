<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mi Proyecto - WebMinds</title>

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="images/favicon.svg">
  <link rel="shortcut icon" href="images/favicon.svg">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" />

  <!-- Styles -->
  <link rel="stylesheet" href="CSS/styles.css" />
  
  <style>
    body {
      background: #f8fafc;
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
    }

    .project-header {
      background: linear-gradient(135deg, #1e3a8a, #2563eb);
      color: white;
      padding: 1rem 0;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    .project-header .container {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .project-title {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 1.5rem;
      font-weight: 700;
      margin: 0;
    }

    .project-nav {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .nav-btn {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 600;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .nav-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .nav-btn.active {
      background: rgba(255, 255, 255, 0.3);
    }

    .project-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
    }

    .project-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      margin-bottom: 2rem;
    }

    .project-card {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
      border: 1px solid #e5e7eb;
    }

    .project-card h3 {
      margin: 0 0 1rem 0;
      color: #1f2937;
      font-size: 1.25rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .progress-section {
      margin-bottom: 2rem;
    }

    .progress-overview {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
      border: 1px solid #e5e7eb;
    }

    .progress-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      text-align: center;
      padding: 1.5rem;
      background: #f8fafc;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
    }

    .stat-number {
      font-size: 2.5rem;
      font-weight: 800;
      margin: 0 0 0.5rem 0;
    }

    .stat-label {
      color: #6b7280;
      font-size: 0.875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .progress-bar-container {
      margin: 1rem 0;
    }

    .progress-bar {
      width: 100%;
      height: 12px;
      background: #e5e7eb;
      border-radius: 6px;
      overflow: hidden;
      margin: 0.5rem 0;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #10b981, #059669);
      border-radius: 6px;
      transition: width 0.3s ease;
    }

    .tasks-section {
      margin-bottom: 2rem;
    }

    .task-list {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
      border: 1px solid #e5e7eb;
    }

    .task-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      border-bottom: 1px solid #f3f4f6;
      transition: all 0.2s;
    }

    .task-item:hover {
      background: #f8fafc;
    }

    .task-item:last-child {
      border-bottom: none;
    }

    .task-checkbox {
      width: 20px;
      height: 20px;
      border-radius: 4px;
      border: 2px solid #d1d5db;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .task-checkbox.checked {
      background: #10b981;
      border-color: #10b981;
      color: white;
    }

    .task-content {
      flex: 1;
    }

    .task-title {
      font-weight: 600;
      color: #1f2937;
      margin: 0 0 0.25rem 0;
    }

    .task-description {
      color: #6b7280;
      font-size: 0.875rem;
      margin: 0;
    }

    .task-status {
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
    }

    .status-pending {
      background: #fef3c7;
      color: #92400e;
    }

    .status-in-progress {
      background: #dbeafe;
      color: #1e40af;
    }

    .status-completed {
      background: #d1fae5;
      color: #065f46;
    }

    .activities-section {
      margin-bottom: 2rem;
    }

    .activity-feed {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
      border: 1px solid #e5e7eb;
      max-height: 500px;
      overflow-y: auto;
    }

    .activity-item {
      display: flex;
      gap: 1rem;
      padding: 1rem 0;
      border-bottom: 1px solid #f3f4f6;
    }

    .activity-item:last-child {
      border-bottom: none;
    }

    .activity-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      flex-shrink: 0;
    }

    .activity-content {
      flex: 1;
    }

    .activity-title {
      font-weight: 600;
      color: #1f2937;
      margin: 0 0 0.25rem 0;
    }

    .activity-time {
      color: #6b7280;
      font-size: 0.75rem;
      margin: 0;
    }

    .timeline-section {
      margin-bottom: 2rem;
    }

    .timeline {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
      border: 1px solid #e5e7eb;
    }

    .timeline-item {
      display: flex;
      gap: 1rem;
      padding: 1rem 0;
      position: relative;
    }

    .timeline-item:not(:last-child)::after {
      content: '';
      position: absolute;
      left: 19px;
      top: 50px;
      width: 2px;
      height: calc(100% - 20px);
      background: #e5e7eb;
    }

    .timeline-dot {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      flex-shrink: 0;
      z-index: 1;
    }

    .timeline-content {
      flex: 1;
    }

    .timeline-title {
      font-weight: 600;
      color: #1f2937;
      margin: 0 0 0.25rem 0;
    }

    .timeline-description {
      color: #6b7280;
      font-size: 0.875rem;
      margin: 0 0 0.5rem 0;
    }

    .timeline-date {
      color: #9ca3af;
      font-size: 0.75rem;
    }

    /* Chat Styles */
    .chat-section {
      margin-bottom: 2rem;
    }

    .chat-container {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
      border: 1px solid #e5e7eb;
      height: 600px;
      display: flex;
      flex-direction: column;
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 1rem 0;
      border-bottom: 1px solid #e5e7eb;
      margin-bottom: 1rem;
    }

    .message {
      display: flex;
      margin-bottom: 1rem;
      animation: slideInMessage 0.3s ease-out;
    }

    .message.system {
      justify-content: center;
    }

    .message.client {
      justify-content: flex-end;
    }

    .message.team {
      justify-content: flex-start;
    }

    .message-content {
      max-width: 70%;
      padding: 0.75rem 1rem;
      border-radius: 12px;
      position: relative;
    }

    .message.system .message-content {
      background: #f3f4f6;
      color: #374151;
      text-align: center;
    }

    .message.client .message-content {
      background: linear-gradient(135deg, #2563eb, #1d4ed8);
      color: white;
    }

    .message.team .message-content {
      background: #f8fafc;
      color: #1f2937;
      border: 1px solid #e5e7eb;
    }

    .message-text {
      margin: 0 0 0.25rem 0;
      line-height: 1.5;
    }

    .message-time {
      font-size: 0.75rem;
      opacity: 0.7;
    }

    .chat-input-container {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .chat-input {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .chat-input input {
      flex: 1;
      padding: 0.75rem 1rem;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 0.875rem;
      transition: all 0.2s;
    }

    .chat-input input:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .chat-input button {
      background: linear-gradient(135deg, #2563eb, #1d4ed8);
      color: white;
      border: none;
      padding: 0.75rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.875rem;
      transition: all 0.2s;
    }

    .chat-input button:hover {
      background: linear-gradient(135deg, #1d4ed8, #1e40af);
      transform: translateY(-1px);
    }

    .chat-actions {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .action-btn {
      background: #f8fafc;
      color: #374151;
      border: 1px solid #e5e7eb;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.75rem;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .action-btn:hover {
      background: #e5e7eb;
      border-color: #d1d5db;
    }

    @keyframes slideInMessage {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .hidden {
      display: none !important;
    }

    .access-denied {
      text-align: center;
      padding: 4rem 2rem;
      background: white;
      border-radius: 12px;
      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
      border: 1px solid #e5e7eb;
    }

    @media (max-width: 1024px) {
      .project-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .project-container {
        padding: 1rem;
      }

      .project-header .container {
        flex-direction: column;
        gap: 1rem;
      }

      .project-nav {
        width: 100%;
        justify-content: center;
      }

      .progress-stats {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>
  <div class="project-header">
    <div class="container">
      <h1 class="project-title">
        <i class="fa-solid fa-project-diagram"></i>
        Mi Proyecto WebMinds
      </h1>
      <div class="project-nav">
        <button class="nav-btn active" onclick="showSection('overview')">
          <i class="fa-solid fa-chart-pie"></i>
          Mi Proyecto
        </button>
        <button class="nav-btn" onclick="showSection('tasks')">
          <i class="fa-solid fa-tasks"></i>
          Tareas
        </button>
        <button class="nav-btn" onclick="showSection('activities')">
          <i class="fa-solid fa-history"></i>
          Actividades
        </button>
        <button class="nav-btn" onclick="showSection('chat')">
          <i class="fa-solid fa-comments"></i>
          Chat
        </button>
        <button class="nav-btn" onclick="logout()">
          <i class="fa-solid fa-sign-out-alt"></i>
          Salir
        </button>
      </div>
    </div>
  </div>

  <div class="project-container">
    <!-- Contenido solo visible para usuarios autenticados -->
    <div id="projectContent" class="hidden">
      <!-- Sección Resumen -->
      <div id="overviewSection" class="section">
        <div class="progress-section">
          <div class="progress-overview">
            <h2 style="margin: 0 0 1.5rem 0; color: #1f2937;">
              <i class="fa-solid fa-chart-line"></i>
              Estado de tu Proyecto
            </h2>
            
            <div class="progress-stats">
              <div class="stat-card">
                <div class="stat-number" style="color: #10b981;">75%</div>
                <div class="stat-label">Progreso</div>
              </div>
              <div class="stat-card">
                <div class="stat-number" style="color: #3b82f6;">12</div>
                <div class="stat-label">Tareas Listas</div>
              </div>
              <div class="stat-card">
                <div class="stat-number" style="color: #f59e0b;">3</div>
                <div class="stat-label">En Trabajo</div>
              </div>
            </div>

            <div class="progress-bar-container">
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <span style="font-weight: 600; color: #374151;">Progreso</span>
                <span style="color: #6b7280;">75%</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" style="width: 75%;"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="project-grid">
          <div class="project-card">
            <h3>
              <i class="fa-solid fa-code"></i>
              Desarrollo Frontend
            </h3>
            <div class="progress-bar-container">
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <span style="font-size: 0.875rem; color: #6b7280;">Progreso</span>
                <span style="font-size: 0.875rem; color: #6b7280;">90%</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" style="width: 90%;"></div>
              </div>
            </div>
            <p style="margin: 1rem 0 0 0; color: #6b7280; font-size: 0.875rem;">
              Sistema de autenticación, páginas principales y funcionalidades básicas completadas.
            </p>
          </div>

          <div class="project-card">
            <h3>
              <i class="fa-solid fa-database"></i>
              Backend & API
            </h3>
            <div class="progress-bar-container">
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <span style="font-size: 0.875rem; color: #6b7280;">Progreso</span>
                <span style="font-size: 0.875rem; color: #6b7280;">60%</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" style="width: 60%;"></div>
              </div>
            </div>
            <p style="margin: 1rem 0 0 0; color: #6b7280; font-size: 0.875rem;">
              Configuración de base de datos y APIs en progreso.
            </p>
          </div>

          <div class="project-card">
            <h3>
              <i class="fa-solid fa-paint-brush"></i>
              Diseño UI/UX
            </h3>
            <div class="progress-bar-container">
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <span style="font-size: 0.875rem; color: #6b7280;">Progreso</span>
                <span style="font-size: 0.875rem; color: #6b7280;">85%</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" style="width: 85%;"></div>
              </div>
            </div>
            <p style="margin: 1rem 0 0 0; color: #6b7280; font-size: 0.875rem;">
              Diseño responsive y componentes principales finalizados.
            </p>
          </div>

          <div class="project-card">
            <h3>
              <i class="fa-solid fa-bug"></i>
              Testing & QA
            </h3>
            <div class="progress-bar-container">
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <span style="font-size: 0.875rem; color: #6b7280;">Progreso</span>
                <span style="font-size: 0.875rem; color: #6b7280;">40%</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" style="width: 40%;"></div>
              </div>
            </div>
            <p style="margin: 1rem 0 0 0; color: #6b7280; font-size: 0.875rem;">
              Pruebas unitarias y de integración en desarrollo.
            </p>
          </div>
        </div>
      </div>

      <!-- Sección Tareas -->
      <div id="tasksSection" class="section hidden">
        <div class="tasks-section">
          <div class="task-list">
            <h2 style="margin: 0 0 1.5rem 0; color: #1f2937;">
              <i class="fa-solid fa-tasks"></i>
              Tus Tareas del Proyecto
            </h2>
            
            <div class="task-item">
              <div class="task-checkbox checked" onclick="toggleTask(this)">
                <i class="fa-solid fa-check"></i>
              </div>
              <div class="task-content">
                <div class="task-title">Sistema de Autenticación</div>
                <div class="task-description">Implementar login con credenciales y sesiones seguras</div>
              </div>
              <div class="task-status status-completed">Completada</div>
            </div>

            <div class="task-item">
              <div class="task-checkbox checked" onclick="toggleTask(this)">
                <i class="fa-solid fa-check"></i>
              </div>
              <div class="task-content">
                <div class="task-title">Diseño de Páginas Principales</div>
                <div class="task-description">Crear index, servicios, contacto y otras páginas principales</div>
              </div>
              <div class="task-status status-completed">Completada</div>
            </div>

            <div class="task-item">
              <div class="task-checkbox checked" onclick="toggleTask(this)">
                <i class="fa-solid fa-check"></i>
              </div>
              <div class="task-content">
                <div class="task-title">Diseño de Interfaz</div>
                <div class="task-description">Crear el diseño visual y experiencia de usuario</div>
              </div>
              <div class="task-status status-completed">Completada</div>
            </div>

            <div class="task-item">
              <div class="task-checkbox" onclick="toggleTask(this)"></div>
              <div class="task-content">
                <div class="task-title">Integración con Base de Datos</div>
                <div class="task-description">Conectar frontend con backend y base de datos</div>
              </div>
              <div class="task-status status-in-progress">En Progreso</div>
            </div>

            <div class="task-item">
              <div class="task-checkbox" onclick="toggleTask(this)"></div>
              <div class="task-content">
                <div class="task-title">Sistema de Notificaciones</div>
                <div class="task-description">Implementar notificaciones en tiempo real</div>
              </div>
              <div class="task-status status-in-progress">En Progreso</div>
            </div>

            <div class="task-item">
              <div class="task-checkbox" onclick="toggleTask(this)"></div>
              <div class="task-content">
                <div class="task-title">Optimización de Rendimiento</div>
                <div class="task-description">Mejorar velocidad de carga y experiencia de usuario</div>
              </div>
              <div class="task-status status-pending">Pendiente</div>
            </div>

            <div class="task-item">
              <div class="task-checkbox" onclick="toggleTask(this)"></div>
              <div class="task-content">
                <div class="task-title">Pruebas de Seguridad</div>
                <div class="task-description">Auditoría de seguridad y pruebas de penetración</div>
              </div>
              <div class="task-status status-pending">Pendiente</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Sección Actividades -->
      <div id="activitiesSection" class="section hidden">
        <div class="activities-section">
          <div class="activity-feed">
            <h2 style="margin: 0 0 1.5rem 0; color: #1f2937;">
              <i class="fa-solid fa-history"></i>
              Actividad Reciente de tu Proyecto
            </h2>
            
            <div class="activity-item">
              <div class="activity-icon" style="background: #d1fae5; color: #065f46;">
                <i class="fa-solid fa-check"></i>
              </div>
              <div class="activity-content">
                <div class="activity-title">Tarea completada: Diseño de Interfaz</div>
                <div class="activity-time">Hace 2 horas</div>
              </div>
            </div>

            <div class="activity-item">
              <div class="activity-icon" style="background: #dbeafe; color: #1e40af;">
                <i class="fa-solid fa-code"></i>
              </div>
              <div class="activity-content">
                <div class="activity-title">Código actualizado: Integración de autenticación</div>
                <div class="activity-time">Hace 4 horas</div>
              </div>
            </div>

            <div class="activity-item">
              <div class="activity-icon" style="background: #fef3c7; color: #92400e;">
                <i class="fa-solid fa-exclamation-triangle"></i>
              </div>
              <div class="activity-content">
                <div class="activity-title">Bug reportado: Error en validación de formularios</div>
                <div class="activity-time">Hace 6 horas</div>
              </div>
            </div>

            <div class="activity-item">
              <div class="activity-icon" style="background: #d1fae5; color: #065f46;">
                <i class="fa-solid fa-plus"></i>
              </div>
              <div class="activity-content">
                <div class="activity-title">Nueva funcionalidad: Sistema de gestión de proyectos</div>
                <div class="activity-time">Hace 8 horas</div>
              </div>
            </div>

            <div class="activity-item">
              <div class="activity-icon" style="background: #e0e7ff; color: #3730a3;">
                <i class="fa-solid fa-user"></i>
              </div>
              <div class="activity-content">
                <div class="activity-title">Usuario agregado: Nuevo miembro del equipo</div>
                <div class="activity-time">Ayer</div>
              </div>
            </div>

            <div class="activity-item">
              <div class="activity-icon" style="background: #f3e8ff; color: #7c3aed;">
                <i class="fa-solid fa-palette"></i>
              </div>
              <div class="activity-content">
                <div class="activity-title">Diseño actualizado: Nuevos componentes UI</div>
                <div class="activity-time">Ayer</div>
              </div>
            </div>
          </div>
        </div>
      </div>


      <!-- Sección Chat -->
      <div id="chatSection" class="section hidden">
        <div class="chat-section">
          <div class="chat-container">
            <h2 style="margin: 0 0 1.5rem 0; color: #1f2937;">
              <i class="fa-solid fa-comments"></i>
              Chat con tu Equipo
            </h2>
            
            <div class="chat-messages" id="chatMessages">
              <div class="message system">
                <div class="message-content">
                  <div class="message-text">¡Hola! Soy el asistente de WebMinds. ¿En qué puedo ayudarte con tu proyecto?</div>
                  <div class="message-time">Ahora</div>
                </div>
              </div>
              
              <div class="message client">
                <div class="message-content">
                  <div class="message-text">Hola, ¿cómo va el progreso de mi sitio web?</div>
                  <div class="message-time">Hace 5 minutos</div>
                </div>
              </div>
              
              <div class="message team">
                <div class="message-content">
                  <div class="message-text">¡Hola! El progreso va muy bien, estamos al 75% completado. Te envío un resumen actualizado.</div>
                  <div class="message-time">Hace 3 minutos</div>
                </div>
              </div>
            </div>
            
            <div class="chat-input-container">
              <div class="chat-input">
                <input type="text" id="chatInput" placeholder="Escribe tu mensaje..." maxlength="500">
                <button id="sendMessage" onclick="sendMessage()">
                  <i class="fa-solid fa-paper-plane"></i>
                </button>
              </div>
              <div class="chat-actions">
                <button class="action-btn" onclick="sendQuickMessage('¿Cómo va mi proyecto?')">
                  <i class="fa-solid fa-question"></i>
                  Estado del proyecto
                </button>
                <button class="action-btn" onclick="sendQuickMessage('Necesito una reunión')">
                  <i class="fa-solid fa-calendar"></i>
                  Solicitar reunión
                </button>
                <button class="action-btn" onclick="sendQuickMessage('Tengo una duda técnica')">
                  <i class="fa-solid fa-cog"></i>
                  Duda técnica
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Mensaje de acceso denegado -->
    <div id="accessDenied" class="access-denied">
      <h2>
        <i class="fa-solid fa-lock"></i>
        Acceso Denegado
      </h2>
      <p>No tienes permisos para acceder al sistema de gestión de proyectos. Por favor, inicia sesión con credenciales válidas.</p>
      <button class="nav-btn" onclick="goToLogin()">
        <i class="fa-solid fa-sign-in-alt"></i>
        Ir al Login
      </button>
    </div>
  </div>

  <script src="js/config.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/projects.js"></script>
  
  <script>
    // Verificar autenticación
    if (!window.webMindsAuth || !window.webMindsAuth.isAuthenticated()) {
      // Redirigir al login si no está autenticado
      window.location.href = 'login.html';
    } else {
      document.getElementById('projectContent').classList.remove('hidden');
      document.getElementById('accessDenied').classList.add('hidden');
    }

    // Funciones de navegación
    function showSection(sectionName) {
      // Ocultar todas las secciones
      document.querySelectorAll('.section').forEach(section => {
        section.classList.add('hidden');
      });
      
      // Ocultar todos los botones activos
      document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Mostrar sección seleccionada
      document.getElementById(sectionName + 'Section').classList.remove('hidden');
      
      // Activar botón correspondiente
      event.target.classList.add('active');
    }

    // Función para toggle de tareas
    function toggleTask(checkbox) {
      checkbox.classList.toggle('checked');
      
      if (checkbox.classList.contains('checked')) {
        checkbox.innerHTML = '<i class="fa-solid fa-check"></i>';
        // Actualizar estado de la tarea
        updateTaskStatus(checkbox);
      } else {
        checkbox.innerHTML = '';
        // Revertir estado de la tarea
        updateTaskStatus(checkbox);
      }
    }

    function updateTaskStatus(checkbox) {
      const taskItem = checkbox.closest('.task-item');
      const statusElement = taskItem.querySelector('.task-status');
      
      if (checkbox.classList.contains('checked')) {
        statusElement.textContent = 'Completada';
        statusElement.className = 'task-status status-completed';
      } else {
        statusElement.textContent = 'Pendiente';
        statusElement.className = 'task-status status-pending';
      }
      
      // Actualizar estadísticas
      updateProjectStats();
    }

    function updateProjectStats() {
      const totalTasks = document.querySelectorAll('.task-item').length;
      const completedTasks = document.querySelectorAll('.task-checkbox.checked').length;
      const progress = Math.round((completedTasks / totalTasks) * 100);
      
      // Actualizar barra de progreso
      document.querySelector('.progress-fill').style.width = progress + '%';
      
      // Actualizar número de tareas completadas
      const statNumbers = document.querySelectorAll('.stat-number');
      if (statNumbers.length > 1) {
        statNumbers[1].textContent = completedTasks;
      }
      
      // Actualizar porcentaje
      if (statNumbers.length > 0) {
        statNumbers[0].textContent = progress + '%';
      }
    }

    function logout() {
      if (confirm('¿Estás seguro de que quieres cerrar sesión?')) {
        window.webMindsAuth.logout();
      }
    }

    function goToLogin() {
      window.location.href = 'login.html';
    }

    // Funciones del chat
    function sendMessage() {
      const input = document.getElementById('chatInput');
      const message = input.value.trim();
      
      if (message) {
        // Obtener el primer proyecto del usuario (en un sistema real, sería el proyecto actual)
        const projects = window.projectManager.getProjectsForUser(window.webMindsAuth.getCurrentUser());
        if (projects.length > 0) {
          const projectId = projects[0].id;
          window.projectManager.sendMessage(projectId, {
            sender: window.webMindsAuth.getCurrentUser(),
            message: message,
            type: 'text'
          });
        }
        
        addMessage('client', message);
        input.value = '';
        
        // Simular respuesta del equipo
        setTimeout(() => {
          const responses = [
            'Gracias por tu mensaje. Te responderemos pronto.',
            'Entendido. El equipo está revisando tu solicitud.',
            'Perfecto, hemos tomado nota de tu comentario.',
            'Te contactaremos para coordinar los próximos pasos.',
            'Excelente pregunta. Te enviaremos más detalles por email.'
          ];
          const randomResponse = responses[Math.floor(Math.random() * responses.length)];
          addMessage('team', randomResponse);
        }, 2000);
      }
    }

    function sendQuickMessage(message) {
      addMessage('client', message);
      
      // Simular respuesta del equipo
      setTimeout(() => {
        const responses = [
          'Perfecto, hemos recibido tu solicitud.',
          'Entendido. Te contactaremos pronto.',
          'Gracias por usar el chat. Te ayudaremos con eso.',
          'Excelente, el equipo está al tanto.',
          'Recibido. Te enviaremos una respuesta detallada.'
        ];
        const randomResponse = responses[Math.floor(Math.random() * responses.length)];
        addMessage('team', randomResponse);
      }, 1500);
    }

    function addMessage(type, text) {
      const messagesContainer = document.getElementById('chatMessages');
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${type}`;
      
      const now = new Date();
      const timeString = now.toLocaleTimeString('es-ES', { 
        hour: '2-digit', 
        minute: '2-digit' 
      });
      
      messageDiv.innerHTML = `
        <div class="message-content">
          <div class="message-text">${text}</div>
          <div class="message-time">${timeString}</div>
        </div>
      `;
      
      messagesContainer.appendChild(messageDiv);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    // Configurar chat
    document.addEventListener('DOMContentLoaded', function() {
      const chatInput = document.getElementById('chatInput');
      if (chatInput) {
        chatInput.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            sendMessage();
          }
        });
      }
      
      // Cargar datos del proyecto
      loadProjectData();
    });

    // Cargar datos del proyecto
    function loadProjectData() {
      const currentUser = window.webMindsAuth.getCurrentUser();
      const projects = window.projectManager.getProjectsForUser(currentUser);
      
      if (projects.length === 0) {
        // No hay proyectos asignados
        document.getElementById('projectName').textContent = 'No hay proyectos asignados';
        document.getElementById('projectClient').textContent = 'Contacta al equipo';
        document.getElementById('projectStatus').textContent = 'Sin proyectos';
        document.getElementById('projectProgress').style.width = '0%';
        document.getElementById('progressText').textContent = '0% completado';
        document.getElementById('projectDescription').textContent = 'No tienes proyectos asignados en este momento.';
        loadTasks([]);
        return;
      }
      
      // Usar el primer proyecto (en un sistema real, permitiría seleccionar)
      const project = projects[0];
      
      // Actualizar la interfaz
      document.getElementById('projectName').textContent = project.name;
      document.getElementById('projectClient').textContent = window.projectManager.getDisplayName(project.client);
      document.getElementById('projectStatus').textContent = getStatusText(project.status);
      document.getElementById('projectProgress').style.width = project.progress + '%';
      document.getElementById('progressText').textContent = project.progress + '% completado';
      document.getElementById('projectDescription').textContent = project.description;
      
      // Cargar tareas
      loadTasks(project.tasks);
    }
    
    function getStatusText(status) {
      const statusMap = {
        'planificacion': 'Planificación',
        'en_progreso': 'En Progreso',
        'completado': 'Completado'
      };
      return statusMap[status] || status;
    }

    // Hacer funciones disponibles globalmente
    window.showSection = showSection;
    window.toggleTask = toggleTask;
    window.logout = logout;
    window.goToLogin = goToLogin;
    window.sendMessage = sendMessage;
    window.sendQuickMessage = sendQuickMessage;
    window.loadProjectData = loadProjectData;
  </script>
</body>
</html>
